@{
    // Définition du titre de la page affiché dans la vue
    ViewData["Title"] = "Paiement Stripe";
}

<!-- Titre principal de la page -->
<h2>Payer vos frais</h2>

<!-- Champ de saisie du montant à payer -->
<label>Montant :</label>
<input id="amount" type="number" min="1" step="0.01" class="form-control" />

<!-- Bouton pour lancer le processus de paiement -->
<button id="btnPay" class="btn btn-primary mt-3">Payer maintenant</button>

<script>
// Ajoute un écouteur d'événement sur le clic du bouton "Payer maintenant"
document.getElementById("btnPay").addEventListener("click", async function () {

    // Récupère la valeur saisie dans le champ de montant
    let amount = document.getElementById("amount").value;

    // Envoie une requête POST vers l'action CreateCheckout (contrôleur Stripe)
    // pour créer une session de paiement Stripe
    const response = await fetch("/Stripe/CreateCheckout", {
        method: "POST", // méthode HTTP utilisée
        headers: { "Content-Type": "application/json" }, // envoie des données JSON
        body: JSON.stringify({
            amount: parseFloat(amount), // conversion de la chaîne en nombre
            successUrl: window.location.origin + "/Stripe/Success", // URL si le paiement réussit
            cancelUrl: window.location.origin + "/Stripe/Cancel"    // URL si l'utilisateur annule
        })
    });

    // Extraction du corps de réponse JSON contenant l'URL de la session de paiement
    const data = await response.json();

    // Redirection de l'utilisateur vers l'URL de paiement Stripe
    window.location.href = data.checkoutUrl;
});
</script>